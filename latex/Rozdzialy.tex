\newcommand\size{0.8}
\renewcommand{\arraystretch}{1.5}

\chapter{Wstêp}
               
%Wstêp do zagadnienia (pó³ strony - jedna strona)               
               
%Wprowadzenie do zagadnieñ poruszanych w pracy w ogólnym, zwiêz³ym ujêciu\footnote{Projekt in¿ynierski: $\pm$kilka paragrafów.}. Osadzenie ich w realiach codziennoœci, ewentualna klasyfikacja wœród problemów szerszej grupy do której nale¿¹ itp. Zdefiniowanie problemu do rozwi¹zania.
%
%\emph{Automatyczna analiza obrazów (AAO)\footnote{Tak wprowadzamy skróty.} jest niezwykle istotn¹ i szybko rozwijaj¹c¹ siê dziedzin¹ nauki. Bez narzêdzi (\ang{tools}) AAO trudno dziœ sobie wyobraziæ ksi¹¿ki o~przetwarzaniu obrazów \cite{Gonzalez} i~inne. Jednym z~popularniejszych narzêdzi analizy s¹ no¿yczki.}

Choroba Gravesa jest najczêstsz¹, idiopatyczn¹ form¹ nadczynnoœci tarczycy. To choroba autoimmunologiczna, powodowana nadaktywnoœci¹ przeciwcia³ przeciwtarczycowych (TRAb). Imituj¹ one dzia³anie hormonu TSH, stymuluj¹c receptory TSH (TSHR). Efektem jest nadprodukcja hormonów tarczycy: trójjodotyroniny (T3) i tyroksyny (T4) \cite{wiki}. Co w konsekwencji prowadzi do nadczynnoœci tarczycy. 

Standardowe leczenie to terapia lekami przeciwtarczycowymi \textit{(antithyroid drugs - ATD)}. Jednym z nich jest metimazol, który hamuje dzia³anie enzymu, odpowiadaj¹cego za syntezê hormonów tarczycy. Taka terapia skutkuje obni¿eniem hormonów T3 i T4, jednak bardzo czêsto wystêpuj¹ reemisje. 

Dotychczas stosowane terapie, s¹ uniwersalne, pozbawione indywidualnego podejœcia. W pracy przedstawiono program do symulacji terapii. Na podstawie danych, pozyskanych z badañ pacjenta, pozwala przewidzieæ odpowiedŸ jego organizmu. Pozwala to skuteczniej zaplanowaæ terapiê i przewidzieæ reemisje. 

%\begin{itemize}
% \item Jak dzia³a tarczyca i jej uk³ad hormonalny.
% \item Co to jest choroba Gravesa. 
% \item Jakie s¹ jej objawy.
% \item U kogo wystêpuje.
% \item Jakie jest na ni¹ lekarstwo. 
%\end{itemize}


%\section{Rozwi¹zania alternatywne}
%Inne metody leczenia? Symulacji?
%Opis ewentualnych znanych sposobów rozwi¹zania problemu wraz z ich ocen¹ najlepiej z wyraŸnym podzia³em na zalety i wady, przy czym najlepiej by z wymienionych wad po czêœci wynika³ cel i przyjête za³o¿enia.\footnote{$\pm$ pó³ strony}
%
%\emph{No¿yczki s¹ czêstym tematem prac badawczych. W~\cite{Malina} nie zosta³y wymienione ¿adne no¿yczki. No¿yczki, które nie zosta³y wymienione w~\cite{Gonzalez}, cechuj¹ siê pe³nym automatyzmem, niestety relatywnie szybko ulegaj¹ stêpieniu.}


\section{Cel pracy}
%\textit{Sformu³owanie celu pracy. Okreœlenie koniecznych do realizacji zadañ, niezbêdnych do osi¹gniêcia celu. Mo¿na je uj¹æ i wymieniæ w postaci za³o¿eñ projektowych z ewentualnym podzia³em na za³o¿enia ogólne i szczegó³owe\footnote{Krótkie}.}
%\textit{
%\emph{Celem pracy jest \textbf{stworzenie automatycznych no¿yczek tn¹cych stopnia trzeciego.} Wymaga to realizacji nastêpuj¹cych etapów:
%\begin{itemize}
% \item wyboru narzêdzi,
% \item opracowania architektury no¿yczek,
% \item testowania no¿yczek w~warunkach zmiennej wilgotnoœci.
%\end{itemize}
%}	
%}
\begin{itemize}
\item Cel bezpoœredni - dostosowanie dawki leku, dla konkretnego pacjenta, dla osi¹gniêcia równowagi uk³adu hormonalnego tarczycy.

\item Cel poœredni - stworzenie oprogramowania, etc. 
\end{itemize}

Niedokoñczone

%\emph{Celem pracy jest \textbf{dostosowanie dawki leku do pacjenta.} Wymaga to realizacji nastêpuj¹cych etapów:
%\begin{itemize}
% \item znalezienie modelu opisuj¹cego ...
% \item stworzenia oprogramowania,
% \item opracowania architektury no¿yczek,
% \item testowania no¿yczek w~warunkach zmiennej wilgotnoœci.
%\end{itemize}
%}

\section{Uk³ad pracy}

NIEDOKOÑCZONE

\textit{Czasem rozdzia³ koñczy siê omówieniem zawartoœci pracy, t³umacz¹cym co czytelnik znajdzie w kolejnych jej rozdzia³ach.
Ka¿dy rozdzia³ warto jest równie¿ poprzedziæ krótkim wstêpem.}

\chapter{Wprowadzenie teoretyczne}
\begin{itemize}
 \item Jak dzia³a tarczyca i jej uk³ad hormonalny. \textit{rysunek poprawnego dzia³ania pêtli sprzê¿enia zwrotnego uk³adu hormonalnego tarczycy}
 \item Co to jest choroba Gravesa. \textit{Tutaj rysunek, jak TRAb emituje dzia³anie TSH.}
 \item Jakie s¹ jej objawy. \textit{Te 3 podpunkty razem.}
 \item U kogo wystêpuje.
 \item Jakie jest na ni¹ lekarstwo. Dzia³anie, skutki uboczne.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Metodologia}\label{Chapter_Metodologia}

Dobór odpowiedniej dawki leku jest mo¿liwy, poprzez symulacjê zachowania siê organizmu pacjenta oraz jego odpowiedzi na terapiê. Celem terapii jest osi¹gniecie stanu, w którym iloœæ hormonu T4 w formie wolnej (oznaczana jako fT4 \cite{ft4}), zmieni siê do wartoœci charakterystycznej dla osoby zdrowej. 

W napisanej przez Autora niniejszej pracy aplikacji okienkowej, zaimplementowano model matematyczny, przedstawiony w pracy Balamurugan Pandiyan i Stephen J. Merrill \cite{graves1}. Wszelkie za³o¿enia i dane, zaczerpniêto z ich pracy.

\section{Za³o¿enia modelu}
Zaimplementowany model matematyczny pozwala obserwowaæ poziom hormonu T3 w formie wolnej, przeciwcia³ TRAb, metimazolu we krwi pacjenta oraz rozmiar gruczo³u tarczycy w czasie. Poni¿ej zosta³y opisane za³o¿enia modelu.

\begin{enumerate}
\item Przeciwcia³a tarczycowe TRAb imituj¹ dzia³anie TSH i stymuluj¹ komórki tarczycowe do wzrostu, produkcji i wydzielania hormonów tarczycy.
\item Po za¿yciu doustnie leku w postaci metimazolu (MMI), jest on szybko i kompletnie absorbowany do surowicy krwi. Jego przyswajalnoœæ, jest estymowana i wynosi œrednio 93%.
\item Tarczyca przyswaja MMI z krwi, który dezaktywuje funkcjonalny wzrost gruczo³u. 
\item Dawka leku wch³ania siê z krwi po jego spo¿yciu.
\item Rozmiar gruczo³u tarczycy jest ukrytym kompartmentem w modelu.
\item Po doustnym podaniu leku, stê¿enie metimazolu w surowicy krwi wykazuje tak¹ sam¹ dynamikê, jak stê¿enie wewn¹trz tarczycy.
\end{enumerate}

\section{Funkcje stanu}

%klucze: (warunki pocz¹tkowe, parametry, zmienne stanu??)

Rozwa¿any model jest uk³adem równañ ró¿niczkowych zwyczajnych w którym przyjmujemy nastêpuj¹ce oznaczenia:

\begin{itemize}
\item x(t) - iloœæ metimazolu (mg) na litr surowicy krwi w chwili czasowej t,
\item y(t) - iloœæ hormonu FT4 (pg) na mililitr surowicy krwi w chwili czasowej t,
\item z(t) - rozmiar funkcjonalny gruczo³u tarczycy (ml) lub objêtoœæ aktywnych komórek w chwili czasowej t.
\item w(t) - iloœæ przeciwcia³ TRAb (U) na mililitr krwii w chwili czasowej t,
\item s(t) - poziom MMI przyjêtego doustnie na litr objêtoœci cia³a w chwili czasowej t.

\end{itemize}

\section{Model matematyczny}

Model symuluj¹cy leczenie pacjenta po przyjêciu metimazolu (MMI) \ref{eq:uklad}. 

\begin{equation} \label{eq:uklad}
\left\lbrace 
\arraycolsep=1.5pt\def\arraystretch{2.2}
\begin{array}{ll}

\dfrac{dx}{dt} = s(t) - \dfrac{(k_{1}z)x}{k_{a} + x} - k_{2}x\\

\dfrac{dy}{dt} = \dfrac{(k_{3}z)w}{k_{d} + w } - k_{4}y\\

\dfrac{dz}{dt} = k_{5} (\dfrac{w}{z} - N) - k_{6}zx\\

\dfrac{dw}{dt} = k_{7} - \dfrac{k_{7}x}{k_{b} + x} - k_{8}w\\
\end{array}
\right.
\end{equation}

Rozwi¹zania modelu przyjmuj¹ wartoœci nieujemne $x(t) \geq 0, y(t) \geq 0, z(t) > 0, w(t) \geq 0$ dla dowolnej chwili czasowej t, z warunkami pocz¹tkowymi $E_{0} = (x_{0}, y_{0}, z_{0}, w_{0})$. Szczegó³owy opis uk³adu znajduje siê w dalszej czêœci sekcji.

\begin{equation}
\label{eq:dxdt}
\dfrac{dx}{dt} = s(t) - \dfrac{(k_{1}z)x}{k_{a} + x} - k_{2}x\\
\end{equation}

Równanie \ref{eq:dxdt} opisuje tempo zmian iloœci metimazolu w chwili t, które zale¿y od dawki metimazolu $s(t)$ przyjêtej przez pacjenta w chwili t, pomniejszonej o 2 sk³adniki. Pierwszy sk³adnik, zgodnie z równaniem Michaelisa-Mentena $\dfrac{(k_{1}z)x}{k_{a} + x}$ charakteryzuje tempo wch³aniania metimazolu (MMI) przez gruczo³ tarczycy, z uwzglêdnieniem jego rozmiaru ($z$), zak³adaj¹c maksymalny wychwyt leku ($k_{1}$). Jest ono podzielone, wed³ug równania kinetycznego Michaelisa-Mentena, przez sta³¹ ($k_{a}$). Drugi sk³adnik $k_{2}x$ odzwierciedla wydalanie lub eliminacjê leku, przez mechanizm niespecyficzny.  /todo wyjaœniæ mechanizm niespecyficzny/

\begin{equation}
\label{eq:dydt}
\dfrac{dy}{dt} = \dfrac{(k_{3}z)w}{k_{d} + w } - k_{4}y \\
\end{equation}

Nastêpne równanie  \ref{eq:dydt} opisuje tempo zmian hormonu tyroksyny w formie wolnej (fT4). Pierwsze wyra¿enie $\dfrac{(k_{3}z)w}{k_{d} + w}$, opisuje znany z poprzedniego \ref{eq:dxdt} równania mechanizm Michaelisa-Mentena, wykorzystany do obliczenia wskaŸnika wydzielania fT4. Jest on pomniejszony, o wskaŸnik eliminacji fT4 z krwi $k_{4}y$. 

\begin{equation}
\label{eq:dzdt}
\dfrac{dz}{dt} = k_{5} (\dfrac{w}{z} - N) - k_{6}zx \\
\end{equation}

Trzecie równanie \ref{eq:dzdt} opisuje zmiany funkcjonalnego rozmiaru gruczo³u tarczycy. Bazuje na maksymalnym wspó³czynniku wzrostu ($N$) i wzglêdnym wspó³czynniku wzrostu ($k_{5}$), w obecnoœci przeciwcia³ przeciwtarczycowych ($w$) \cite{trab} $k_{5}(\dfrac{w}{z} - N)$. Pomniejszone o wspó³czynnik funckjonalnego rozmiaru tarczycy dla komórek nieaktywowanych przez leczenie MMI. 

\begin{equation}
\label{eq:dwdt}
\dfrac{dw}{dt} = k_{7} - \dfrac{k_{7}x}{k_{b} + x} - k_{8}w
\end{equation}

Równanie \ref{eq:dwdt} opisuje tempo zmian stê¿enia przeciwcia³ przeciwtarczycowych. Parametr $k_{7}$ przedstawiaj¹cy maksymaln¹ produkcjê przeciwcia³ TRAb, spowodowan¹ odpowiedzi¹ autoimmunologiczn¹. Œrodkowe wyra¿enie $\dfrac{k_{7}x}{k_{b} + x}$, przedstawia mechanizm hamowania odpowiedzi immunologicznej, spowodowany podaniem metimazolu. Ostatnie wyra¿enie $k_{8}w$, odnosi siê do opóŸnienia, jakie dotyczy eliminacji TRAb spowodowanego leczeniem.
\\

\section{Parametry modelu}
Na podstawie literatury /todo: cite/ przyjêto parametry modelu, zebrane w tabeli (Tab. \ref{tab:params}).

\begin{table}[h]
\caption{Parametry wejœciowe uk³adu równañ ró¿niczkowych.}
\label{tab:params}
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Parametr} & \textbf{Opis}                                                                                                    & \textbf{Wartoœæ}              & \textbf{Jednostka}            \\ \hline
$k_{1}$                & \begin{tabular}[c]{@{}l@{}}Wzglêdne maksimum wykorzystania \\ MMI.\end{tabular}                                  & $8,374\cdot 10^{3}$ & mg/($ml\cdot l\text{dzieñ}$)                  \\ \hline
$k_{2}$              & WskaŸnik eliminacji MMI.                                                                                         & 3,3271                        & 1/\text{dzieñ}                         \\ \hline
$k_{a}$                & \begin{tabular}[c]{@{}l@{}}Sta³a Michealisa-Mentena po³owicznego \\ maksymalnego wykorzystania MMI.\end{tabular} & 0,358068                      & mg/L                          \\ \hline
$k_{3}$                & Wzglêdne maksimum sekrecji FT4.                                                                                  & 0,119                         & $pg/(ml^{2}\cdot\text{dzieñ})$                   \\ \hline
$k_{d}$                & \begin{tabular}[c]{@{}l@{}}Sta³a Michealisa-Mentena\\ po³owicznej maksymalnej  sekrecji FT4.\end{tabular}        & 0,05                          & U/ml                          \\ \hline
$k_{4}$                & WskaŸnik eliminacji FT4.                                                                                         & 0,099021                      & 1/\text{dzieñ}                         \\ \hline
$k_{5}$                
& \begin{tabular}[c]{@{}l@{}}
Wzglêdny wspó³czynnik wzrostu \\ gruczo³u tarczycy.\end{tabular}                      & $1 \cdot 10^{6}$       & $ml^{3}/(U\cdot\text{dzieñ})$ \\ \hline
N                 
& \begin{tabular}[c]{@{}l@{}}
Maksymalny wspó³czynnik wzrostu \\ gruczo³u tarczycy.\end{tabular}                             & 0,833                         & $U/(ml^{2})$     \\ \hline
$k_{6}$                
& \begin{tabular}[c]{@{}l@{}}
Wspó³czynnik nieaktywnych komórek \\ tarczycy.\end{tabular}                           & 0,001                         & $ml/(mg\cdot\text{dzieñ})$                   \\ \hline
$k_{7}$                & \begin{tabular}[c]{@{}l@{}}Maksymalny wspó³czynnik produkcji\\ przeciwcia³ TRAb.\end{tabular}                    & 0,875                         & $U/(ml\cdot\text{dzieñ})$                    \\ \hline
$k_{b}$                & \begin{tabular}[c]{@{}l@{}}Wspó³czynnik hamowania produkcji \\ przeciwcia³.\end{tabular}                         & 1,5                           & mg/L                          \\ \hline
$k_{8}$                & WskaŸnik eliminacji TRAb.                                                                                        & 0,035                         & 1/\text{dzieñ}                         \\ \hline
\end{tabular}
\end{table}

Maksymalna szybkoœæ pobierania MMI wzrasta wraz ze zwiêkszeniem dawki leku, ale powy¿ej 15 mg/dzieñ, wzrost ten mo¿na pomin¹æ. Maksymalne wch³anianie leku, odbywa siê zatem, kiedy dawka wynosi 15 mg/dzieñ. Zak³adaj¹c, ¿e standardowa objêtoœæ funkcjonalna gruczo³u tarczycy podczas nadczynnoœci wynosi 30 ml, a 59,71 l to standardowa objêtoœæ organizmu, mo¿emy estymowaæ parametr $k_{1} = \dfrac{15}{30\cdot 59,71} = 8,374 \cdot 10^{-3} mg/ml\cdot \text{\textit{ldzieñ}}$.

Zak³ada siê, ¿e wspó³czynnik wydalania MMI przez organizm niespecyficzny jest wyk³adniczy i mo¿e zostaæ obliczony jako $k_{2} = \dfrac{ln(2)}{5h} = 3,43711/\text{\textit{dzieñ}}$.

Najwiêksze wydalanie metimazolu, wystêpuje oko³o godziny 12 dla maksymalnej przyjêtej dawki 15 mg/dzieñ. Ta informacja pozwala okreœliæ wartoœæ $k_{a} = 0.358068 mg/l$ przez symulacje, korzystaj¹c z równania dynamicznego Michealisa-Mentena. 

Parametr $k_{3}$ jest przekszta³conym równaniem \ref{eq3} modelu. Posiadaj¹c informacje z badañ pacjentów podczas ich pierwszej wizyty, mo¿emy obliczyæ
$k_{3} = \dfrac{k_{4}y_{0}(k_{d}+w_{0})}{z_{0}w_{0}}$.

Parametr $k_{d}$ zosta³ estymowany w programie Matlab, u¿ywaj¹c procedury optymalizacyjnej \textbf{fmincon} z doln¹ granic¹ wynosz¹c¹ 0.05 i górn¹ granic¹ 0.1. 

Nastêpnie $k_{3} = \dfrac{k_{4}y_{0}(k_{d}+w_{0})}{z_{0}w_{0}}$.

Parametr $k_{4}$ to wspó³czynnik wydalania fT4 z organizmu. Zak³adaj¹c niespecyficzny mechanizm, wspó³czynnik wydalania jest wyk³adniczy i mo¿e byæ wyliczony jako $k_{4} = \dfrac{ln(2)}{7 dni} = 0.099021 l/\text{\textit{dzieñ}}$.

Parametry $k_{5}$ oraz $k_{6}$ zosta³y wyznaczone podczas symulacji.

Parametr N, zosta³ wyliczony bazuj¹c na danych TRAb i fT4 pacjenta $N = \dfrac{w_{0}}{z_{0}}$.

Parametr $k_{8}$ okreœla czas ¿ycia przeciwcia³. Zak³ada siê, ¿e jest on wyk³adniczy i mo¿e zostaæ wyliczony jako $k8 = \dfrac{ln(2)}{20dni} = 0.035 l/\text{\textit{dzieñ}}$. 

Parametr $k_{7}$ zosta³ estymowany jako 
$k_{7} = k_{8} \cdot w_{0}$.

Parametr $k_{b}$ jest wspó³czynnikiem po³owicznego maksymalnego hamowania stê¿enia przeciwcia³ TRAb (sta³a Michealisa-Mentena), który mo¿e zostaæ wyestymowany, za pomoc¹ procedury \textbf{fmincon} w doln¹ granic¹ 3 i górn¹ 12.

%\begin{equation} 
%\end{equation}
%
%\begin{equation} \label{eq2}
%\dfrac{dy}{dt} = \dfrac{(k_{3}z)w}{k_{d} + w } - k_{4}y, \quad y(t0) = y0
%\end{equation}
%
%\begin{equation} \label{eq3}
%\dfrac{dz}{dt} = k_{5} (\dfrac{w}{z} - N) - k_{6}zx, \quad z(t0) = z0
%\end{equation}
%
%\begin{equation} \label{eq4}
%\dfrac{dw}{dt} = k_{7} - \dfrac{k_{7}x}{k_{b} + x} - k_{8}w, \quad w(t0) = w0 
%\end{equation}

\section{Warunki pocz¹tkowe modelu}

Warunki pocz¹tkowe modelu $E_{0} = (x_{0}, y_{0}, z_{0}, w_{0})$, zosta³y ustalone w sposób nastêpuj¹cy:

Stê¿enie pocz¹tkowe FT4 $(y_{0})$ oraz przeciwcia³ TRAb $(w_{0})$ pochodzi z badañ podczas pierwszej wizyty pacjenta. 

Pocz¹tkow¹ wartoœæ MMI $(x_{0})$ \ref{eq:x0} wyliczono na podstawie dawki leku i objêtoœci dystrybucji metimazolu w organiŸmie, wynosz¹cym 3 litry. 

\begin{equation}
\label{eq:x0}
x_{0} = \dfrac{\text{Dawka leku}}{\text{Objêtoœæ dystrybucji leku w organiŸmie}}
\end{equation}


Pocz¹tkowy rozmiar funkcjonalny tarczycy $(z_{0})$ \ref{eq:z0} wyznaczono przekszta³caj¹c pierwsze równanie ró¿niczkowe \ref{eq:dxdt}.

\begin{equation}
\label{eq:z0}
z_{0} = \dfrac{(s(t) - k_{2}x_{0})(k_{a} + x_{0})}{k_{1}x_{0}}
\end{equation}

\section{Dane do symulacji}\label{sec:dane}

\begin{table}[]
\caption{Parametry wybranych pacjentów.}
\label{tab:pacjenci}
\begin{tabular}{|l|l|l|l|l|}
\hline
\textbf{Parametr} & \textbf{Pacjent nr 20} & \textbf{Pacjent nr 31} & \textbf{Pacjent nr 55} & \textbf{Pacjant nr 70} \\ \hline
$k_{1}$                & $8,374 \cdot 10^{3}$   & $8,374 \cdot 10^{3}$   & $8,374 \cdot 10^{3}$   & $8,374 \cdot 10^{3}$   \\ \hline
$k_{2}$                & 3,3271                 & 3,3272                 & 3,3273                 & 3,3274                 \\ \hline
$k_{a}$                & 0,358068               & 0,358068               & 0,358068               & 0,358068               \\ \hline
$k_{3}$                & 0,085                  & 0,08975                & 0,08992                & 0,11784                \\ \hline
$k_{d}$                & 0,067                  & 0,07                   & 0,081                  & 0,075                  \\ \hline
$k_{4}$                & 0,099021               & 0,099021               & 0,099021               & 0,099021               \\ \hline
$k_{5}$                & $10^{6}$               & $10^{6}$               & $10^{6}$               & $10^{6}$               \\ \hline
N                 & 0,25                   & 0,058                  & 0,207                  & 0,293                  \\ \hline
$k_{6}$                & 0,001                  & 0,001                  & 0,001                  & 0,001                  \\ \hline
$k_{7}$                & 0,26                   & 0,061                  & 0,22                   & 0,308                  \\ \hline
$k_{b}$                & 4,95                   & 11,8                   & 4,09                   & 3,15                   \\ \hline
$k_{8}$                & 0,035                  & 0,035                  & 0,035                  & 0,035                  \\ \hline
\end{tabular}
\end{table}

W niniejszej pracy przeprowadzono szereg symulacji modelu leczenia choroby Gravesa na podstawie danych do³¹czonych do artyku³u \cite{graves1}. Pochodz¹ one z badañ 23 pacjentów. Zawieraj¹ informacje o poziomie fT4, TRAb oraz dniu terapii, w którym badanie zosta³o przeprowadzone.

Autorzy pos³ugiwali siê danymi leczenia ponad 70 chorych, wybieraj¹c te, które by³y kompletne. U wielu pacjentów wystêpuj¹ braki z badania TRAb. Dzieje siê tak, poniewa¿ przy wizycie kontrolnej, pomiar fT4 jest wystarczaj¹cy, do okreœlenia stadium choroby.

W przeprowadzonych symulacjach wykorzystano jedynie dane z pierwszej wizyty. Pomiary w trakcie leczenia zosta³y u¿yte do sprawdzenia poprawnoœci dzia³ania modelu.

Do analiz na potrzeby tej pracy, wykorzystano dane 4 pacjentów (pacjenta nr 20, 31, 55, 70). Zosta³y one przedstawione w tabeli (Tab. \ref{tab:pacjenci}).

\section{Stabilnoœæ uk³adu}

Przeanalizowano stabilnoœæ uk³adu dla nieleczonej nadczynnoœci tarczycy, spowodowanej chorob¹ Gravesa. Pos³u¿ono siê omówionym wczeœniej modelem. Do analizy u¿yto twierdzenia o stabilnoœci uk³adów, bazuj¹cego na wartoœciach w³asnych. 

\subsection{Twierdzenie} 
Niech funkcje $f_{i}(y_{1}, y_{2}, ..., y_{n})$ maj¹ ci¹g³e pochodne cz¹stkowe pierwszego rzêdu $(\dfrac{\partial f_{i}}{\partial y_{1}})$, gdzie $1\leq i,j\leq n$, w otoczeniu punkt równowagi $P=(a_{1},a_{2}, ..., a_{n})$ uk³adu. Dodatkowo niech 
\[
J(a_{1},a_{2}, ..., a_{n})
=
\begin{bmatrix}
(\dfrac{\partial f_{1}}{\partial y_{1}}) 
& (\dfrac{\partial f_{1}}{\partial y_{2}}) 
& \cdots 
& (\dfrac{\partial f_{1}}{\partial y_{n}}) \\

(\dfrac{\partial f_{2}}{\partial y_{1}}) 
& (\dfrac{\partial f_{2}}{\partial y_{3}}) 
& \cdots 
& (\dfrac{\partial f_{2}}{\partial y_{n}}) \\

\vdots & \vdots & \ddots & \vdots \\

(\dfrac{\partial f_{n}}{\partial y_{1}}) 
& (\dfrac{\partial f_{n}}{\partial y_{2}}) 
& \cdots 
& (\dfrac{\partial f_{n}}{\partial y_{n}}) 
\end{bmatrix},
\]
gdzie pochodne cz¹stkowe obliczane s¹ w punkcie $(a_{1},a_{2}, ..., a_{n})$.

Wówczas:
\begin{enumerate}
\item je¿eli wszystkie wartoœci w³asne macierzy Jacobiego J(P) maj¹ ujemne czêœci rzeczywiste, to punkt $P=(a_{1},a_{2}, ..., a_{n})$ jest asymptotycznie stabilnym punktem równowagi uk³adu
\item je¿eli co najmniej jedna wartoœæ w³asna macierzy J(P) ma dodatni¹ czêœæ rzeczywist¹, to punkt $P=(a_{1},a_{2}, ..., a_{n})$ jest niestabilnym punktem równowagi uk³adu autonomicznego.
\end{enumerate}

\subsection{Analiza stabilnoœci modelu}
Gdy nie podaje siê metimazolu $s(t)=0$, stan nadczynnoœci tarczycy opisuje siê jako $E_{1} = (x_{1}, y_{1}, z_{1}, w_{1})$, gdzie 

\begin{equation} \label{eq:e1}
\left\lbrace 
\arraycolsep=1.5pt\def\arraystretch{2.2}
\begin{array}{ll}

x_{1} = 0 \\

y_{1} = \dfrac{k_{3}k_{3}^{2}}{k_{4}k_{8}N(k_{8}k{d}+k{7})}  \\

z_{1} = \dfrac{k_{7}}{k_{8}N}\\

w_{1} = \dfrac{k_{7}}{k_{8}}

\end{array}
\right.
\end{equation}

Obliczaj¹c pochodne cz¹stkowe modelu $f'(x, y, z, w)$, otrzymujemy nastêpuj¹c¹ macierz o wymiarach $4x4$. 

\[
J
=
\begin{bmatrix}
\dfrac{-(k_{1}k_{a}z+k_{2}(x+k_{a})^2)}{(x+k_{a})^{2}} 
& 0 
& \dfrac{-xk_{1}}{(x+k_{a})} 
& 0 \\

0
& -k_{4} 
& \dfrac{wk_{3}}{w+k_{d}}
& \dfrac{zk_{3}k_{d}}{(w+k_{d})^{2}}  \\

-zk_{6} 
& 0
& \dfrac{-wk_{5}}{z^{2}} - xk_{6}
& \dfrac{k_{5}}{z} \\

\dfrac{-k_{7}k_{b}}{(x+k_{b})^{2}}
& 0
& 0
& -k_{8}

\end{bmatrix},
\]

Podstawiaj¹c do macierzy warunki pocz¹tkowe, okreœlone w uk³adzie \ref{eq:e1}, otrzymujemy macierz

\[
J
=
\begin{bmatrix}
-\dfrac{k_{1}k_{7}}{k_{8}Nk_{a}} - k_{2}
& 0 
& 0
& 0 \\

0
& -k_{4} 
& \dfrac{k_{3}k_{7}}{k_{8}k_{d}+k_{7}}
& \dfrac{k_{3}k_{7}k_{8}k_{d}}{N(k_{8}k_{d}+k_{7})^{2}} \\

-\dfrac{k_{6}k_{7}}{k_{8}N} 
& 0
& \dfrac{k_{5}k_{8}N^{2}}{k_{7}}
& \dfrac{k_{5}k_{8}N}{k_{7}} \\

\dfrac{k_{7}}{k_{b}}
& 0
& 0
& -k_{8}

\end{bmatrix},
\]

Wartoœci w³asne macierzy oblicza siê za pomoc¹ równania charakterystycznego macierzy w postaci $det(J - \lambda I) = 0$. Wartoœci w³asne przedstawiaj¹ siê nastêpuj¹co:

\begin{equation} \label{eq:lambda}
\left\lbrace 
\arraycolsep=1.5pt\def\arraystretch{2.2}
\begin{array}{ll}

\lambda_{1} = -k_{4} \\

\lambda_{2} = -k_{8}  \\

\lambda_{3} = -\dfrac{k_{1}k_{7}}{k_{8}Nk_{a}} -k_{2} \\

\lambda_{4} = -\dfrac{k_{5}k_{8}N^2}{k_{7}}

\end{array}
\right.
\end{equation}

Wszystkie wartoœci w³asne maj¹ znak ujemny oraz parametry je opisuj¹ce s¹ dodatnie. Wynika z tego, ¿e wszystkie wartoœci w³asne omawianej macierzy $J$ maj¹ ujemne czêœci rzeczywiste. Wed³ug twierdzenia o stabilnoœci uk³adu, uk³ad jest uk³adem asymptotycznie stabilnym.

Szczegó³owe obliczenia zosta³y przedstawione w dodatku. (ref - kiedy ju¿ bêdzie dodatek)

%\emph{Przeprowadzenie symulacji wi¹¿e siê z kilkoma etapami. }
%
%\section{Problem 1}
%\emph{Stworzone no¿yczki powinny cechowaæ siê du¿¹ odpornoœci¹ na korozjê cyfrow¹. Mo¿na w~tym celu wykorzstaæ izolacjê od znaków wodnych (Rys.~\ref{f1}) na poziomie warstwy p³ótna.}
%
%\begin{figure}[H]
% \subfloat[Podpis 1\label{f1:c1}]{\includegraphics[width=0.45\textwidth]{logoPS}} \; % <--- to daje odstêp w poziomie; \\ daje now¹ linijkê
% \subfloat[Podpis 2\label{f1:c2}]{\includegraphics[width=0.45\textwidth]{logoRIB}} 
%  \caption{Podpis ca³oœci nawi¹zuj¹cy do podpisu \protect\subref{f1:c1}.\label{f1}} % wykorzystanie subref mo¿e wymagaæ dodania \protect !!!
%\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Czêœæ konstrukcyjna/Specyfikacja wewnêtrzna}
%Czêœæ konstrukcyjna lub implementacyjna, t³umacz¹ca sposób realizacji zadania, omówion¹ w poprzedniej czêœci opracowania. Wyjaœnienie wyborów elementów, sprzêtu lub programów. W przypadku programów obiektowych podzia³ na klasy, pola, metody wraz z uzasadnieniem.
%
%\emph{W trakcie realizacji zadania, w~pierwszym kroku, nale¿y odizolowaæ znaki wodne w~warstwie p³ótna. Wykorzystano w~tym celu dostêpn¹ w~œrodowisku XYZ funkcje Z. Parametry do funkcji okreœlono poprez\ldots}

Projekt zosta³ zrealizowany w programie MATLAB. Jest to œrodowisko do wykonywania obliczeñ naukowych i in¿ynierskich, oraz do tworzenia symulacji komputerowych \cite{matlab}. Do utworzenia graficznego interfejsu, u¿yto œrodowiska Appdesigner, który jest stosunkowo nowym narzêdziem programu MATLAB.

\section{Interfejsy i klasy}
\begin{table}[]
\caption{Klasy i interfejsy aplikacji.}
\label{tab:interfejsy}
\begin{tabular}{|p{4cm}|p{10.5cm}|}

\hline
\textbf{Zmienna} & \textbf{Opis}                                                                                                                  \\ \hline
Patient          & Parametry pacjenta oraz wyniki pierwszego badania fT4 i TRAb.                                     \\ \hline
Dose             & Iloœæ metimazolu i czasu dawki leczenia.                                                                      \\ \hline
InitialValues    & Warunki pocz¹tkowe symulacji.                                                                       \\ \hline
StabilityPoint   & Punkty stacjonarne uk³adu.
\\ \hline
Eigen            & Wartoœci w³asne uk³adu.                                                                            \\ \hline
T                & Wektor z punktami czasowymi symulacji.                                                                                         \\ \hline
X                & Rozwi¹zania równañ ró¿niczkowych.
 \\ \hline
StartData        & Wszystkie pola i struktury potrzebne do startu aplikacji.                                                                      \\ \hline
Simulation       & Wszystkie pola i struktury potrzebne do rozpoczêcia symulacji.                                                                 \\ \hline
SimulationResult & Wszystkie pola i struktury potrzebne do wyœwietlenia wyników symulacji.                                                        \\ \hline
\end{tabular}
\end{table}
Utworzono kilka interfejsów i klas, których opis zawarto w tabeli (Tab. \ref{tab:interfejsy}).



Aplikacja przesy³a dane g³ównie pomiêdzy dwoma widokami:
\begin{enumerate}
\item App - Aplikacja jest inicjalizowana. Wczytujemy dane, wybieramy szczegó³y symulacji oraz j¹ rozpoczynamy.
\item SimulationView - W tym widoku obserwujemy symulacjê.
\end{enumerate}

\section{Przep³yw danych w aplikacji}
Do przekazania danych pomiêdzy widokami aplikacji, s³u¿¹ g³ównie trzy interfejsy. S¹ to:
\begin{enumerate}
\item StartData (Rys.~\ref{start_data_img})
\item Simulation (Rys.~\ref{i-simulation_img})
\item SimulationResult (Rys.~\ref{simulation_result_img})
\end{enumerate}

\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{visio/start_data}
	\caption{Interfejs StartData.}\label{start_data_img}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{visio/simulation}
	\caption{Interfejs Simulation.}\label{i-simulation_img}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{visio/simulation_result}
	\caption{Interfejs SimulationResult.}\label{simulation_result_img}
\end{figure}

\section{Metody utworzonego programu}\label{sec:methods}

\subsubsection*{Simulate}
Metoda Simulate zajmuje siê wszystkimi obliczeniami zwi¹zanymi z symulacj¹. Przyjmuje obiekt typu Simulation (Rys. \ref{simulation_img}) i zwraca SimulationResult (Rys. \ref{simulation_result_img}).
\begin{lstlisting}
function SimulationResult = Simulate(Simulation)
\end{lstlisting}

\subsubsection*{UkladRownan}
Metoda \textit{UkladRownan} przyjmuje chwilê czasow¹ t, warunki pocz¹tkowe uk³adu, parametry pacjenta oraz dawki leczenia. Metoda ta jest wykorzystywana przez solver ode45 do symulacji uk³adu w ka¿dej chwili czasowej t. Zwraca rozwi¹zania uk³adu równañ.
\begin{lstlisting}
function rownania = UkladRownan(t, InitialValuesVector, PatientVector, DoseVector)
\end{lstlisting}


\subsubsection*{TreatmentDose}
Metoda \textit{TreatmentDose} przyjmuje dawki leku, liczbê dni leczenia oraz chwilê czasow¹ t. Metoda ta jest wykorzystywana przez solver ode45, do obliczania przyjmowanej iloœci MMI czyli funkcji s(t).
\begin{lstlisting}
function s = TreatmentDose(DOSES, DAYS, t)
\end{lstlisting}

\subsubsection*{StabilityPoints}
Metoda \textit{StabilityPoints} przyjmuje parametry pacjenta i zwraca punkt w przestrzeni 4-wymiarowej, w którym uk³ad osi¹gnie stabilnoœæ.
\begin{lstlisting}
function points = StabilityPoints(patient)
\end{lstlisting}


\subsubsection*{JacobainMatrix}
Metoda \textit{JacobainMatrix} przyjmuje parametry pacjenta i warunki pocz¹tkowe. Zwraca macierz Jacobiego dla danego uk³adu.
\begin{lstlisting}
function matrix = JacobainMatrix( patient, initialValues )
\end{lstlisting}

\subsubsection*{ConvertStringToNArray}
Metoda \textit{ConvertStringToNArray} konwertuje napis, na tablice. Jako, ¿e jest to osobna metoda w programie, zosta³a sprawdzona testem jednostkowym.
\begin{lstlisting}
function [arrayOutput] = ConvertStringInputToNArray(textInput)
\end{lstlisting}

\subsubsection*{Test\_convertStringInputToNArray}
Test jednostkowy - implementacja skryptu:
\begin{lstlisting}
input = '10, 12, 20, 30';
expected = [10 12 20 30 0]; % N element array

result = ConvertStringInputToNArray(input, 5);

if isequal(result, expected)
    disp('convertStringInputToNArray correct!'); 
else
    disp('convertStringInputToNArray failed!'); 
end
\end{lstlisting}

\subsubsection*{ParsingErrorDialog}
Niektóre z wprowadzanych danych s¹ napisami, dlatego aplikacja jest zabezpieczona przed niepoprawnymi wpisami. U¿ytkownik otrzymuje stosowne powiadomienie o b³êdzie, dziêki funkcji \textit{parsingErrorDialog}.
\begin{lstlisting}
function parsingErrorDialog(axis)
\end{lstlisting}

\subsubsection*{ShowSimulation}
Do narysowania wyników symulacji w czasie s³u¿y metoda \textit{ShowSimulation}. Przyjmuje ona wykres (UIAxes), dane do wykreœlenia (T, X) oraz tytu³ wykresu (pLabel).
\begin{lstlisting}
function ShowSimulation( UIAxes, T, X, pLabel )
\end{lstlisting}


\subsubsection*{PrintFigure}
Appdesigner nie obs³uguje zaawansowanej manipulacji wykresami, dlatego do zapisywania nale¿y utworzyæ figure typu widmo, kopiuj¹c wszystkie informacje z poprzedniego wykresu. S³u¿y do tego metoda \textit{PrintFigure}.
\begin{lstlisting}
function PrintFigure(plotFigure, name)
\end{lstlisting}

\subsubsection*{PlotPhase}
Do narysowania portretów fazowych symulacji, s³u¿y metoda \textit{PlotPhase}.
\begin{lstlisting}
function PlotPhase(ax, x, y, px, py, xlab, ylab)
\end{lstlisting}

\subsubsection*{FindFT4NormalRange}
\textit{FindFT4NormalRange} jest funkcj¹ dodatkow¹. Nie jest zaimplementowana w graficznym interfejsie aplikacji. Wypisuje w konsoli programu Matlab iloœæ dni, po których pacjent, osi¹ga graniczny poziom fT4, dla osoby zdrowej.
\begin{lstlisting}
function timeUpFT4 = FindFT4NormalRange(T, X)
\end{lstlisting}

\section{Wykorzystane funkcje programu Matlab}
\subsubsection*{Ode45}

Do rozwi¹zywania uk³adu równañ ró¿niczkowych u¿yto funkcji \textbf{ode45}. Pocz¹tkowo u¿yto bazowej wersji funkcji ode45:

\begin{lstlisting}
[t,y] = ode45(odefun(t,y,A,B),tspan,y0)
\end{lstlisting}

Parametry funkcji:
\begin{itemize}
\item odefun - funkcja zwracaj¹ca równania ró¿niczkowe w punkcie t\ref{sec:methods},
\item tspan - przedzia³ czasowy symulacji,
\item y0 - punkty pocz¹tkowe równañ,
\item A i B - wektory z dodatkowymi parametrami.
\end{itemize}

Funkcja \textit{ode45} zwraca wektor [t,y] gdzie:
\begin{itemize}
\item t - wektor czasowy,
\item y - wektory rozwi¹zañ uk³adu równañ ró¿niczkowych.
\end{itemize}

Dla optymalizacji pamiêci programu u¿yto przeci¹¿enia metody, która mo¿e przyj¹æ dodatkowe parametry A i B, bez umieszczania ich w macierzy wynikowej y. Za ich pomoc¹ przekazywane s¹ dane wybranego pacjenta oraz dawki leku. Dziêki takiemu rozwi¹zaniu, symulacja zajmuje ponad 4 razy mniej miejsca pamiêci RAM.
\begin{lstlisting}
[t,y] = ode45(@(t,y) odefcn(t,y,A,B), tspan, y0);
\end{lstlisting}

\subsubsection*{Eig}
\begin{lstlisting}
e = eig(A)
\end{lstlisting}
Funkcja przyjmuje macierz kwadratow¹ A. Zwraca wektor kolumnowy z wartoœciami w³asnymi macierzy A.

\subsubsection*{Solve}
\begin{lstlisting}
results = solve(eqns, syms);
\end{lstlisting}
Funkcja rozwi¹zuje uk³ady równañ u¿ywaj¹c zmiennych symbolicznych. Przyjmuje dwa parametry:
\begin{itemize}
\item eqns - tablicê równañ,
\item syms - tablicê zmiennych symbolicznych u¿ytych w równaniach.
\end{itemize}
Funkcja zwraca wyniki dla zmiennych symbolicznych.

\subsubsection*{Find}
\begin{lstlisting}
k = find(X,n,direction)
\end{lstlisting}
Funkcja przeszukuje wartoœci tablicy lub listy, zwracaj¹c indeksy, w których równanie jest prawdziwe. Przyjmuje trzy zmienne:
\begin{itemize}
\item X - równanie zawieraj¹ce tablicê do przeszukania i zmienn¹ do której przyrównuje,
\item n - iloœæ indeksów, które pierwsze zostan¹ przyporz¹dkowane,
\item direction - kierunek przyporz¹dkowania.
\end{itemize}

\subsubsection*{Strsplit}
\begin{lstlisting}
C = strsplit(str,delimiter)
\end{lstlisting}
Funkcja dzieli napis na tablicê napisów w miejscach okreœlonego znaku i zwraca tablicê napisów. Parametry funkcji:
\begin{itemize}
\item str - napis,
\item delimeter - znak, w którego miejscach napis jest roz³¹czany.
\end{itemize}


%Jeœli projekt, praca dotyczy systemu informatycznego, w dokumentacji umieszcza siê z~regu³y jedynie interfejs programistyczny (b¹dŸ jego fragmenty). Pe³ny kod mo¿na do³¹czyæ w za³¹czniku.

%\lstset{ %
%numbers=left, 
%}

%\begin{lstlisting}
%private double losuj(int ile, double min, double max);
%\end{lstlisting}
%
%Metoda losuje liczbê z~podanego zakresu. Przed zwróceniem wartoœci, losowanie
%powtarzane jest wybran¹ liczbê razy w~celu zwiêkszenia czasu obliczeñ.
%
%\begin{itemize}
% \item Parametry:
%    \begin{description}
%    \item[ile] okreœla ile rezy nale¿y losowaæ przed zwróceniem liczby,
%    \item[min] definiuje wartoœæ minimaln¹,
%    \item[max] definiuje wartoœæ minimaln¹,
%    \end{description}
% \item Wartoœæ zwracana: wylosowana liczba
% \item B³êdy: w~przypadku, gdy \lstinline{ile} $< 0$, zg³aszany jest wyj¹tek \lstinline{WrongIleException}
%\end{itemize}
%
%
%itd. 
%
%czasami warto omówiæ wybrane fragmenty razem z~implementacj¹
%
%\begin{lstlisting}[numbers=right, numbersep=-5pt]%, stepnumber=2]
%...
%double x = 2 ^ 1023-3 / 22;
%int z = (int)x; 
%p = x - z;
%...
%\end{lstlisting}
%
%\emph{w pierwszej kolejnoœci stosowana jest sta³a Krafta do redukcji z³o¿onoœci ciêcia (linijka~2).}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Instrukcja obs³ugi/Specyfikacja zewnêtrzna}
W tej czêœci zostanie szczegó³owo omówiony program autora pracy wraz z instrukcj¹ jego obs³ugi.

\section{Okno g³ówne}
Na rysunku (Rys. \ref{window1_img}) przedstawiono g³ówne okno aplikacji. S³u¿y ono do konfiguracji symulacji. Mo¿na podzieliæ ja na 3 ró¿ne czêœci. 

\begin{figure}
	\centering
	\includegraphics[width=1\textwidth]{specs/window1}
	\caption{Okno g³ówne aplikacji.}\label{window1_img}
\end{figure}

\subsection{Wybór pacjenta}
W pierwszej czêœci, któr¹ przedstawia zdjêcie (Rys. \ref{choose-patient_img}) wybiera siê pacjenta, na którym przeprowadzane s¹ symulacje. Parametry, które go opisuj¹ przedstawia tabela. Do wyboru jest 4 pacjentów (Rys. \ref{patient-list_img}), którzy s¹ analizowani w tej pracy. Dodatkowych pacjentów nale¿y dodaæ z poziomu kodu.

\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{specs/choose-patient}
	\caption{Wybór pacjenta.}\label{choose-patient_img}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{specs/patient-list}
	\caption{Lista wyboru pacjenta.}\label{patient-list_img}
\end{figure}

\subsection{Wybór parametrów symulacji}
Ta czêœæ s³u¿y do wyboru parametrów symulacji (Rys. \ref{simulation_img}): czasu, leczenia i dawki metimazolu. W pierszym polu wpisuje siê czas symulacji wyra¿ony w dniach. Nastêpnie na w³¹czniku, mo¿emy wybraæ, leczenie lub brak leczenia dla pacjenta. W³¹czenie terapii aktywuje pole dawki leku, w którym wybiera siê iloœæ metimazolu, jak¹ codziennie przyjmuje pacjent.

Terapie mog¹ byæ bardzo skomplikowane, dlatego istnieje mo¿liwoœæ utworzenia serii leczenia. Wystarczy wpisaæ w te pola kilka wartoœci po przecinku. Dla u³atwienia pod spodem znajduj¹ siê 3 przyciski. Pierwsze 2 - "Simple Dose" i "Advanced Dose" automatycznie wpisuj¹ w omawiane wczeœniej pola przyk³adowe terapie. Trzeci przycisk daje informacjê, jak wype³niaæ pola. Na rysunku (Rys. \ref{adv-treatment_img}) pokazano przyk³adow¹ zaawansowan¹ terapiê.

\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{specs/simulation}
	\caption{Konfiguracja symulacji bez leczenia.}\label{simulation_img}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{specs/adv-treatment}
	\caption{Konfiguracja zaawansowanego leczenia.}\label{adv-treatment_img}
\end{figure}

\subsection{Warunki pocz¹tkowe}

Warunki pocz¹tkowe s¹ w pe³ni zautomatyzowane. S¹ pokazane na rysunku (Rys. \ref{initial_img}). Poziom fT4, przeciwcia³ i wielkoœæ komórek ustalaj¹ siê po wyborze pacjenta. Pole MMI ustawia siê po wybraniu dawki. 

\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{specs/initial}
	\caption{Przyk³adowe warunki pocz¹tkowe.}\label{initial_img}
\end{figure}

\subsection{Symulacja}
Naciœniêcie przycisku symulacji, rozpoczyna obliczenia. Oczekiwanie potwierdza okno modalne z paskiem postêpu (Rys. \ref{progressbar_img}).
\begin{figure}
	\centering
	\includegraphics[width=0.6\textwidth]{specs/progressbar}
	\caption{Okno modalne oczekiwania na obliczenia.}\label{progressbar_img}
\end{figure}

\section{Okno symulacji}
\textit{Niedokoñczone}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Rezultaty}
%Zobrazowanie i omówienie wyników otrzymywanych wskutek zastosowania danego urz¹dzenia b¹dŸ aplikacji. Badanie ewentualnych parametrów (takich jak dok³adnoœæ, czu³oœæ...), czy te¿ zachowania w szczególnych sytuacjach. O ile to mo¿liwe tabelaryzacja rezultatów oraz ich statystyczna interpretacja. Ocena zachowania zaproponowanego rozwi¹zania. Analiza mo¿liwych przyczyn wyst¹pienia b³êdów. 

W oparciu o program stworzony przez autora pracy, symulowano ró¿ne scenariusze terapii pacjentów. Do analizy modelu u¿yto danych 4 pacjentów(Ref. \ref{sec:dane}), zmagaj¹cych siê z nadczynnoœci¹ tarczycy Gravesa—Basedowa. W tej czêœci pracy zosta³y przedstawione symulacje leczenia chorych. 

\section{Wstêpne porównanie pacjentów}

Na wykresie (Rys.~\ref{pacjenci_ft4_trab_img}) porównano analizowanych pacjentów, ze wzglêdu na zmierzone wartoœci fT4 i TRAb. Badanie mia³o miejsce podczas pierwszej wizyty u lekarza. 

Na najwiêksz¹ nadczynnoœæ tarczycy, wed³ug poziomu fT4, cierpi pacjent numer 70. Potwierdza to najwy¿szy poziom przeciwcia³ TRAb w jego krwi. Poziom fT4 pozosta³ych pacjentów jest zbli¿ony. Pacjent numer 30 ma znacz¹co ni¿sz¹ wartoœæ przeciwcia³. Jego organizm mo¿e byæ bardzo czu³y na wystêpowanie przeciwcia³ lub nadczynnoœæ jest spowodowana innym czynnikiem.

\begin{figure}
	\centering
	\includegraphics[width=1\textwidth]{excel/pacjenci_ft4_trab}
	\caption{Porównanie fT4 i TRAb analizowanych pacjentów.}\label{pacjenci_ft4_trab_img}
\end{figure}

\section{Pacjent numer 20}

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_no_dose_d10}
	\caption{Pacjent nr 20, nie leczony.}\label{p20_no_dose_img}
\end{figure}

Na pocz¹tku analizowano stan pacjenta, bez podania leku. Poziom FT4 pacjenta wynosi 25,63 pg/ml. Jest to znacznie powy¿ej normy (7-18 pg/ml). Œwiadczy to o nadczynnoœci tarczycy. Przy symulacji trwaj¹cej 10 dni, ¿adne przebiegi czasowe nie ulegaj¹ zmianie. Mo¿na to zaobserwowaæ na rysunku (Rys.~\ref{p20_no_dose_img}). Dla nieskoñczenie d³ugiego okresu, rezultaty s¹ takie same. Wynika to z faktu, ¿e przy braku leczenia, model jest asymptotycznie stabilny.

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_dose30_d1}
	\caption{Pacjent nr 20, leczony 30 mg leku.}\label{p20_dose30_d1_img}
\end{figure}

Po jednorazowym podaniu 30 mg MMI (Rys.~\ref{p20_dose30_d1_img}), lek zostaje ca³kowicie wydalony przez organizm w czasie jednego dnia. Ta dawka nie ma znacz¹cego wp³ywu na funkcje tarczycy. 
 
\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_dose30_d120}
	\caption{Pacjent nr 20, leczony dawk¹ 30 mg leku przez 120 dni.}\label{p20_dose30_d120_img}
\end{figure}

Przy podawaniu 30mg leku przez 120 dni, stan gospodarki hormonalnej tarczycy pacjenta, znacz¹co siê zmieni³ (Rys.~\ref{p20_dose30_d120_img}). Po oko³o 30 dniach, poziom FT4 pacjenta osi¹gn¹³ graniczny poziom dla osoby zdrowej. Kontynuowanie terapii przy tej samej dawce, skutkuje ci¹g³ym obni¿aniem siê hormonu. Na skutek tego, po 90 dniach osi¹ga poziom œwiadcz¹cy o niedoczynnoœci tarczycy.

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_dose30_d75_dose0_d45}
	\caption{Pacjent nr 20, leczenie i obserwacja.}\label{p20_dose30_d75_dose0_d45_img}
\end{figure}
  
Jak pokazano na wykresie (Rys.~\ref{p20_dose30_d75_dose0_d45_img}) przy podawaniu dawki 30 mg przez 75 dni i odstawieniu leku, pacjent powróci³ do stanu nadczynnoœci tarczycy. Trwa³o to oko³o 35 dni. Pacjent wymaga nastêpnej serii leczenia. 	

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_treatment}
	\caption{Pacjent nr 20, przyk³adowe leczenie.}\label{p20_treatment_img}
\end{figure}

Na rysunku (Rys.~\ref{p20_treatment_img}), pokazano przyk³adowe leczenie pacjenta numer 20. Przy leczeniu dawk¹ 30 mg przez 2 miesi¹ce, stê¿enie FT4 pacjenta osi¹gnê³o górn¹ graniczn¹ wartoœæ po 27 dniach. Po 60 dniach wynosi³o 12,3 pg/ml. Postanowiono zwiêkszyæ dawkê metizamolu do 40 mg dziennie. Graniczna wartoœæ zosta³a osi¹gniêta po 25 dniach, a stê¿enie pod koniec etapu wynios³o 10,97 pg/ml. Nastêpnie zmniejszono dawkê do 20 pg/ml i 10 pg/ml. Po tym okresie nale¿y zaobserwowaæ czy choroba jest w stadium reemisji. Jeœli tak, nale¿y zacz¹æ seriê leczenia od pocz¹tku.

W artykue A. Prakash'a \cite{mmi}, opisane zosta³y ró¿ne stosowane metody leczenia choroby Gravesa. Niektóre z badañ wskazuj¹, ¿e du¿e dawki metimazolu i krótka terapia zwiêkszaj¹ ryzyko wyst¹pienia nawrotów choroby. Optymalna d³ugoœæ terapii powinna wynosiæ 12-18 miesiêcy. Przy 18-miesiêcznej terapii, ryzyko nawrotu choroby to 37\%. 6-miesiêczna terapia wywo³a nawrót u 58\% leczonych.

Sugerowana terapia dla pacjenta nr 20 przedstawia siê nastêpuj¹co (Rys.~\ref{p20_treatment1_img}). FT4 cz³owieka zdrowego osi¹ga po 27 dniach terapii.

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p20_treatment1}
	\caption{Pacjent nr 20, sugerowane leczenie.}\label{p20_treatment1_img}
\end{figure}

\section{Pacjent numer 31}

Pacjent numer 31 jest odmiennym przypadkiem. Jego poziom przeciwcia³ jest niski w odniesieniu do innych pacjentów, przy podobnym stê¿eniu fT4. Symulacje wykaza³y, ¿e jest ma³o wra¿liwy na leczenie metimazolem. Dla tego pacjenta, warto rozpatrywaæ inne metody leczenia. Sugerowane leczenie obejmuje wiêksze dawki leku. Sugerowana terapia trwa 180 dni (Rys.~\ref{p31_treatment_img}), przy czym ostatnie 6 miesiêcy, pacjent dostaje 10 mg MMI.

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p31_treatment}
	\caption{Pacjent nr 31, sugerowane leczenie.}\label{p31_treatment_img}
\end{figure}


\section{Pacjent numer 55}

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p55_treatment}
	\caption{Pacjent nr 55, sugerowane leczenie.}\label{p55_treatment_img}
\end{figure}

Rysunek (Rys.~\ref{p55_treatment_img}) sugeruje leczenie pacjenta numer 55. Zastosowano to samo leczenie, co w przypadku pacjenta nr 20 (Rys.~\ref{p20_treatment_img}). Po 29 dniach jego poziom fT4 odpowiada górnej granicy osoby zdrowej. Po 60 dniach, mo¿e obni¿yæ dawkê z 30 do 20 mg. 


\section{Pacjent numer 70}

Pacjent nr 70 ma najwy¿szy pocz¹tkowy poziom fT4. Proponowana terapia trwa 14 miesiêcy (Rys.~\ref{p70_treatment_img}). Jako, ¿e jego poziom ft4 koreluje z wysokim poziomem TRAb, chory dobrze reaguje na leczenie. FT4 osoby zdrowej osi¹ga po 42 dniach. 

\begin{figure}
	\centering
	\includegraphics[width=\size\textwidth]{wyniki/p70_treatment}
	\caption{Pacjent nr 70, sugerowane leczenie.}\label{p70_treatment_img}
\end{figure}

\section{Porównanie zapotrzebowania na lek}

Przeanalizowano zapotrzebowanie na lek omawianych w pracy pacjentów. Zsumowano iloœæ przyjêtego leku, podczas sugerowanego leczenia, przez okres pierwszych 360 dni. Dla niektórych, jest to koniec terapii. Wyniki przedstawione zosta³y na wykresie (Rys.~\ref{pacjenci_mmi_img}). 3/4 pacjentów przyjmie oko³o 5g leku. Pacjent numer 31 musi przyj¹æ 10g leku oraz bêdzie kontynuowa³ leczenie przez 6 miesiêcy.

\begin{figure}
	\centering
	\includegraphics[width=1\textwidth]{excel/pacjenci_mmi}
	\caption{Porównanie zapotrzebowania na lek pacjentów.}\label{pacjenci_mmi_img}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Podsumowanie}

\section{Wnioski}
\begin{itemize}
\item Czas leczenia mo¿e, ale nie musi wp³ywaæ na prawdopodobieñstwo reemisji. 
\item Zwiêkszenie dawki leku przyœpiesza obni¿enie poziomu hormonów tarczycy.
\item Model pozwala przewidzieæ, kiedy mo¿e nast¹piæ reemisja choroby.
\item Model nie pozwala przewidzieæ czy nast¹pi reemisja choroby.
\end{itemize}
%Nawi¹zanie do celu pracy oraz postawionych za³o¿eñ. Próba oceny realizacji celu, poprzez weryfikacjê otrzymanych rezultatów. Analiza dostrze¿onych problemów, b³êdnego, nieoczekiwanego dzia³ania, ewentualnych problemów napotkanych podczas realizacji. W przypadku niewyczerpania tematu, a tak¿e wspomnianego niepo¿¹danego zachowania urz¹dzenia/aplikacji sugestie ich eliminacji wymienione jako plany na przysz³oœæ.\footnote{Krótkie! 1-2 strony.}
%
%Wstêp wraz z podsumowaniem winny stanowiæ swego rodzaju klamrê, a nawet ca³oœæ w takim rozumieniu, ¿e przeczytanie wy³¹cznie tych dwóch rozdzia³ów t³umaczyæ powinno rozwa¿any problem wraz z efektami otrzymanymi w efekcie prac, stanowi¹cymi jego rozwi¹zanie, bez wnikania w sposób ich otrzymania (to zawiera czêœæ œrodkowa).
